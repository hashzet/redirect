
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lembaga KPSM dan TLN Tahun 2026</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .sidebar {
            background: linear-gradient(180deg, #454B1B 0%, #383d15 100%);
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto; /* Enable vertical scrolling */
            max-height: 100vh; /* Limit height to viewport height */
        }

        .profile-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .profile-card:hover {
            transform: translateY(-2px);
        }

        .nav-button {
            transition: all 0.2s;
        }

        .nav-button:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .sidebar-link {
            transition: all 0.2s;
            padding: 0.3rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.1rem;
        }

        .sidebar-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .active-link {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .qualification-item {
            border-left: 3px solid #454B1B;
            padding-left: 1rem;
            margin-bottom: 1rem;
        }

        .evaluation-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            outline: none;
            appearance: none;
            -webkit-appearance: none;
        }

        .evaluation-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #454B1B;
            cursor: pointer;
            transition: all 0.2s;
        }

        .evaluation-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .checkbox-wrapper {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 8px;
        }

        .save-button {
            transition: all 0.2s;
            opacity: 0.5;
            cursor: not-allowed;
            background: #454B1B;
        }

        .save-button.active {
            opacity: 1;
            cursor: pointer;
            background: #454B1B;
        }

        .save-button.active:hover {
            transform: scale(1.05);
            background: #454B1B;
        }
        .examiner-select {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.5rem;
            border-radius: 8px;
            width: 100%;
            margin-bottom: 1rem;
            cursor: pointer;
        }

        .examiner-select option {
            background-color: #454B1B;
            color: white;
        }

        .examiner-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .clear-examiner {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            display: none;
        }

        .clear-examiner.visible {
            display: block;
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
        }

        .profile-header img {
            width: 150px;
            height: 150px;
            border-radius: 5%;
            margin-right: 1.5rem;
            object-fit: cover;
        }

        .profile-header h2 {
            font-size: 1.75rem;
            font-weight: 600;
            color: #333;
        }
         .menu-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            color: white;
            transition: all 0.2s;
            cursor: pointer;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .menu-section {
            margin-bottom: 2rem;
        }

        .menu-header {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.5rem;
            padding-left: 1rem;
        }

        .total-marks {
            background: #454B1B;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* Add these to your existing styles */
.menu-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    transition: all 0.2s;
}

.menu-item:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.menu-item.active {
    background-color: rgba(255, 255, 255, 0.2);
}

.section-header {
        background: linear-gradient(90deg, #454B1B 0%, #5a612c 100%);
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .footer {
        background: linear-gradient(180deg, #454B1B 0%, #383d15 100%);
        color: white;
        padding: 1.5rem;
        text-align: center;
        position: relative;
        bottom: 0;
        width: 100%;
        margin-top: 3rem;
    }

    .footer-content {
        max-width: 1200px;
        margin: 0 auto;
    }

    .copyright {
        font-size: 0.875rem;
        opacity: 0.9;
    }

    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .loading-spinner {
        background: white;
        padding: 2rem;
        border-radius: 0.5rem;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #454B1B;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @media print {
    /* Hide the sidebar, footer, navigation buttons, and loading overlay */
    .sidebar, .footer, .nav-button, .loading-overlay {
        display: none;
    }

    /* Ensure the main content takes the full width */
    main {
        margin: 0;
        padding: 0;
        width: 100%;
        box-sizing: border-box;
    }

    /* Style the profile card for printing */
    .profile-card {
        page-break-inside: avoid;
        break-inside: avoid;
        border: none;
        padding: 1rem;
        margin: 0 auto;
        width: 100%;
        box-shadow: none;
        box-sizing: border-box;
    }

    /* Ensure images print at full resolution */
    img {
        max-width: 100% !important;
        height: auto !important;
    }

    /* Optional: Add a header or footer for printed pages */
    @page {
        margin: 1cm;
        size: A4;
    }

    body {
        width: 100%;
        margin: 0;
        padding: 0;
        font-size: 14px;
    }

    /* Ensure all content fits within the printable area */
    .profile-header, .section-header, .qualification-item, .evaluation-slider {
        width: 100%;
        box-sizing: border-box;
    }

    /* Adjust grid layout for printing */
    .grid {
        display: block;
    }

    .grid-cols-1, .grid-cols-2 {
        grid-template-columns: 1fr;
    }

    /* Ensure sections are full width */
    .section-header, .qualification-item, .evaluation-slider {
        width: 100%;
        box-sizing: border-box;
    }

    /* Remove any flexbox constraints */
    .flex, .justify-center, .gap-4, .mt-8 {
        display: block;
        width: 100%;
        box-sizing: border-box;
    }
}

    </style>
</head>
<body class="min-h-screen">
    <div class="flex">
        <div class="sidebar w-72 min-h-screen p-6 text-white fixed">
            <div class="flex flex-col items-center mb-8">
                <div class="w-24 h-24 bg-white rounded-full mb-4 overflow-hidden">
                    <img src="https://i.ibb.co/mWJsy8N/Untitled-design-7.png" alt="Inf Dir" class="w-full h-full object-cover">
                </div>
                <h1 id="groupTitle" class="text-xl font-semibold text-center">LEMBAGA PENCALONAN KPSM/TLN 2026</h1>
            </div>
            <div class="examiner-container mb-6">
                <select id="examinerSelect" class="examiner-select">
                    <option value="">Pilih Ahli Panel</option>
                    <option value="Pengarah Inf">Pengarah Inf</option>
                    <option value="Timb Pengarah Inf">Timb Pengarah Inf</option>
                    <option value="PS 1 A">PS 1 A</option>
                    <option value="PS 2 A RAMD">PS 2 A RAMD</option>
                    <option value="PS 2 A RRD">PS 2 A RRD</option>
                    <option value="PS 2 Kerjaya RS">PS 2 Kerjaya RS</option>
                </select>
                <span id="clearExaminer" class="clear-examiner" title="Clear selection">&times;</span>
            </div>

            <!-- Menu section -->
            <div class="menu-section">
                <h3 class="menu-header">MENU</h3>
                <div id="mainMenu">
                    <div class="menu-item" data-page="home">
                        <span>Home</span>
                    </div>
                    <div class="menu-item" data-page="result">
                        <span>Result</span>
                    </div>
                </div>
            </div>

            <!-- Modified Groups section -->
            <div class="menu-section">
                <h3 class="menu-header">KOR</h3>
                <nav id="korList" class="space-y-2">
                    <!-- Kor groups will be added here -->
                </nav>
            </div>
        </div>

        <main class="flex-1 ml-72 p-8">
            <div id="homeContent" class="hidden">
                <div class="flex justify-center items-center h-screen">
                    <img src="https://i.ibb.co/s9hTS3KH/IMG-20250216-125123.jpg" alt="Home Logo" class="max-w-xl">
                </div>
            </div>
            
            <!-- Add this just before the profilesContainer div in the HTML -->
<div id="searchContainer" class="hidden max-w-4xl mx-auto mb-6">
    <div class="flex">
        <input 
            type="text" 
            id="searchInput" 
            placeholder="Insert Military Number" 
            class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
        >
        <button 
            id="searchButton" 
            class="ml-2 bg-green-600 text-white px-6 py-2 rounded-lg"
        >
            Search
        </button>
    </div>
</div>
            
            <div id="profilesContainer" class="max-w-4xl mx-auto">
                <!-- Profiles will be added here -->
            </div>

            <div class="flex justify-center gap-4 mt-8">
                <button id="prevBtn" class="nav-button bg-green-600 text-white px-6 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
                    Previous
                </button>
                <button id="nextBtn" class="nav-button bg-green-600 text-white px-6 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
                    Next
                </button>
            </div>
        </main>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Saving evaluation...</p>
        </div>
    </div>

    <script>
        let filteredProfiles = [];
        let selectedExaminer = '';
        const examinerSelect = document.getElementById('examinerSelect');
        const clearExaminer = document.getElementById('clearExaminer');

        function initializeExaminerSelection() {
            const savedExaminer = sessionStorage.getItem('selectedExaminer');
            if (savedExaminer) {
                examinerSelect.value = savedExaminer;
                selectedExaminer = savedExaminer;
                clearExaminer.classList.add('visible');
                examinerSelect.disabled = true;
            }

            examinerSelect.addEventListener('change', function() {
                selectedExaminer = this.value;
                if (selectedExaminer) {
                    sessionStorage.setItem('selectedExaminer', selectedExaminer);
                    clearExaminer.classList.add('visible');
                    this.disabled = true;
                }
            });

            clearExaminer.addEventListener('click', function() {
                sessionStorage.removeItem('selectedExaminer');
                examinerSelect.value = '';
                selectedExaminer = '';
                clearExaminer.classList.remove('visible');
                examinerSelect.disabled = false;
            });
        }

        const profilesContainer = document.getElementById('profilesContainer');
        const groupList = document.getElementById('groupList');
        const groupTitle = document.getElementById('groupTitle');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        let profiles = [];
        let currentIndex = 0;
        let currentGroup = '';

        async function fetchData() {
            const response = await fetch('https://script.google.com/macros/s/AKfycbyFZCjZqNHZ0nlk4ZE7qJkHtFFwsHQDqwney7G_yP3uew3DuwOb9T48-T6m75a1T8UM/exec');
            const data = await response.json();
            profiles = data;
            displayKorGroups(data);
            showHomePage(); // Show home page by default
        }

        function showHomePage() {
            document.getElementById('homeContent').classList.remove('hidden');
            document.getElementById('profilesContainer').classList.add('hidden');
            document.querySelector('.flex.justify-center.gap-4.mt-8').classList.add('hidden');
            currentGroup = '';
            filteredProfiles = [];
        }

        function displayKorGroups(data) {
            
            // In the displayKorGroups function, update the menu item
            const resultButton = document.querySelector('[data-page="result"]');
            if (resultButton) {
            resultButton.querySelector('span').textContent = 'Search';
            }
            
            // Get unique KOR values
            const kors = [...new Set(data.map(item => item.KOR))];
            const korList = document.getElementById('korList');
            
            // Clear existing content
            korList.innerHTML = '';
            
            // Create sections for each KOR
            kors.forEach(kor => {
                // Get groups specific to this KOR
                const korGroups = [...new Set(data
                    .filter(item => item.KOR === kor)
                    .map(item => item.NO_KUMP))]
                    .sort((a, b) => {
                        // Extract numbers from strings and compare
                        const numA = parseInt(a.match(/\d+/)[0]);
                        const numB = parseInt(b.match(/\d+/)[0]);
                        return numA - numB;
                    });
                
                const korSection = document.createElement('div');
                korSection.className = 'mb-4';
                
                // Create KOR header button
                const korHeader = document.createElement('div');
                korHeader.className = 'menu-item';
                korHeader.innerHTML = `
                    <span class="flex-1">${kor}</span>
                    <span class="text-sm text-gray-300">(${korGroups.length})</span>
                `;
                
                // Create container for groups
                const groupsList = document.createElement('div');
                groupsList.className = 'ml-4 hidden space-y-1 mt-2';
                groupsList.setAttribute('data-kor', kor);
                
                // Add groups for this KOR
                korGroups.forEach(group => {
                    const groupItem = document.createElement('div');
                    groupItem.className = 'menu-item text-sm';
                    
                    // Count members in this group
                    const membersCount = data.filter(profile => 
                        profile.KOR === kor && profile.NO_KUMP === group
                    ).length;
                    
                    groupItem.innerHTML = `
                        <span class="flex-1">${group}</span>
                        <span class="text-xs text-gray-300">${membersCount} calon</span>
                    `;
                    
                    groupItem.addEventListener('click', () => {
                        // Hide search container when clicking on a group
                        document.getElementById('searchContainer').classList.add('hidden');
                        
                        // Hide home content and show profiles
                        document.getElementById('homeContent').classList.add('hidden');
                        document.getElementById('profilesContainer').classList.remove('hidden');
                        document.querySelector('.flex.justify-center.gap-4.mt-8').classList.remove('hidden');
                        
                        // Update current group and filtered profiles
                        currentGroup = group;
                        filteredProfiles = data.filter(profile => 
                            profile.KOR === kor && profile.NO_KUMP === group
                        );
                        currentIndex = 0;
                        
                        // Update title and display first profile
                        groupTitle.textContent = `LEMBAGA PENCALONAN KPSM/TLN 2026 ${kor} ${group}`;
                        displayProfile(currentIndex);
                        
                        // Update active states
                        document.querySelectorAll('.menu-item').forEach(item => 
                            item.classList.remove('active')
                        );
                        groupItem.classList.add('active');
                    });
                    
                    groupsList.appendChild(groupItem);
                });
                
                // Toggle groups visibility when KOR header is clicked
                korHeader.addEventListener('click', (e) => {
                    // Hide all other group lists
                    document.querySelectorAll('[data-kor]').forEach(el => {
                        if (el !== groupsList) {
                            el.classList.add('hidden');
                        }
                    });
                    
                    // Toggle this group list
                    groupsList.classList.toggle('hidden');
                    
                    // Update active states
                    document.querySelectorAll('.menu-item').forEach(item => 
                        item.classList.remove('active')
                    );
                    korHeader.classList.add('active');
                });
                
                korSection.appendChild(korHeader);
                korSection.appendChild(groupsList);
                korList.appendChild(korSection);
            });
        
            // Add home button functionality
            const homeButton = document.querySelector('[data-page="home"]');
            if (homeButton) {
                homeButton.addEventListener('click', () => {
                    document.getElementById('homeContent').classList.remove('hidden');
                    document.getElementById('profilesContainer').classList.add('hidden');
                    document.querySelector('.flex.justify-center.gap-4.mt-8').classList.add('hidden');
                    
                    // Reset current group and filtered profiles
                    currentGroup = '';
                    filteredProfiles = [];
                    
                    // Update active states
                    document.querySelectorAll('.menu-item').forEach(item => 
                        item.classList.remove('active')
                    );
                    homeButton.classList.add('active');
                });
            }
        }
        


        function formatQualification(profile, mainField, kedField, gredField) {
            const mainValue = profile[mainField] || '-';
            const kedValue = profile[kedField] ? ` (${profile[kedField]})` : '';
            const gredValue = profile[gredField] ? ` | Gred: ${profile[gredField]}` : '';
            return `${mainValue}${kedValue}${gredValue}`;
        }

        function displayProfile(index) {
            const profilesToUse = currentGroup ? filteredProfiles : profiles;
            const profile = profilesToUse[index];
            
            const sections = [
                {
                    title: 'Jawatan & Pasukan',
                    fields: ['JAWATAN', 'PASUKAN', 'TAHUN_DI_PSK']
                },
                {
                    title: 'Maklumat Perkhidmatan',
                    fields: ['MULA_KHIDMAT', 'TARIKH_TAULIAH', 'TAHUN_KHIDMAT', 'PENGAMBILAN', 'CATATAN']
                },
                {
                    title: 'Maklumat Peribadi',
                    fields: ['TARIKH_LAHIR', 'UMUR', 'TEMPAT_LAHIR', 'STATUS', 'AKADEMIK', 'BMI','UKA']
                }
            ];

            const qualificationsSection = {
                title: 'Kursus & Pencapaian',
                groups: [
                    {
                        title: '',
                        fields: ['MERIT']
                    },
                    {
                        title: 'G2',
                        value: 'Siri ' + formatQualification(profile, 'SIRI_G2', 'KED_G2', 'GRED_G2')
                    },
                    {
                        title: 'G3',
                        value: 'Siri ' + formatQualification(profile, 'SIRI_G3', 'KED_G3', 'GRED_G3')
                    },
                    {
                        title: 'Ketua Kompeni',
                        value: 'Siri ' + formatQualification(profile, 'SIRI_KK', 'KED_KK', 'GRED_KK')
                    },
                    {
                        title: 'Kursus Lain',
                        fields: ['KURSUS_BAHASA', 'KURSUS_UN', 'PENGLIBATAN_LUAR_NEGARA']
                    },
                    {
                        title: 'Ujian ADFELPS',
                        fields: ['SPEAKING', 'LISTENING', 'READING', 'WRITING']
                    }
                ]
            };

            <!-- Modify the sections HTML generation in the displayProfile function -->
const sectionsHTML = sections.map(section => `
    <div class="mb-8">
        <h3 class="section-header text-lg font-semibold">${section.title}</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${section.fields.map(field => `
                <div class="flex flex-col">
                    <span class="text-sm text-gray-500">${field.replace(/_/g, ' ')}</span>
                    <span class="font-medium">${profile[field] || '-'}</span>
                </div>
            `).join('')}
        </div>
    </div>
`).join('');

<!-- Modify the qualificationsHTML to include the new header style -->
const qualificationsHTML = `
    <div class="mb-8">
        <h3 class="section-header text-lg font-semibold">${qualificationsSection.title}</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            ${qualificationsSection.groups.map(group => {
                if (group.fields) {
                    return `
                        <div class="qualification-item">
                            <h4 class="font-medium text-green-800 mb-2">${group.title}</h4>
                            ${group.fields.map(field => `
                                <div class="mb-2">
                                    <span class="text-sm text-gray-500">${field.replace(/_/g, ' ')}</span>
                                    <span class="block font-medium">${profile[field] || '-'}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    return `
                        <div class="qualification-item">
                            <h4 class="font-medium text-green-800 mb-2">${group.title}</h4>
                            <span class="block font-medium">${group.value}</span>
                        </div>
                    `;
                }
            }).join('')}
        </div>
    </div>
`;

const totalMarksHTML = `
<div class="text-right mb-4">
    <span id="total-marks" class="total-marks">Total Marks: 0/100</span>
</div>
`;

const evaluationHTML = `
<div class="mb-8 mt-8 border-t pt-8">
    <h2 class="section-header text-lg font-semibold">${profile.TAJUK}</h2>
    <h3 class="section-header text-lg font-semibold mt-6">Performance Evaluation</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Comm Skill (25%)
                </label>
                <input type="range"
                       class="evaluation-slider"
                       id="speech-slider"
                       min="0"
                       max="25"
                       value="0"
                       oninput="updateSliderValue(this, 'speech-value')">
                <span id="speech-value" class="text-sm text-gray-500">0%</span>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Appearance (25%)
                </label>
                <input type="range"
                       class="evaluation-slider"
                       id="appearance-slider"
                       min="0"
                       max="25"
                       value="0"
                       oninput="updateSliderValue(this, 'appearance-value')">
                <span id="appearance-value" class="text-sm text-gray-500">0%</span>
            </div>
        </div>

        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Idea/Knowledge (25%)
                </label>
                <input type="range"
                       class="evaluation-slider"
                       id="idea-slider"
                       min="0"
                       max="25"
                       value="0"
                       oninput="updateSliderValue(this, 'idea-value')">
                <span id="idea-value" class="text-sm text-gray-500">0%</span>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Confidence (25%)
                </label>
                <input type="range"
                       class="evaluation-slider"
                       id="confidence-slider"
                       min="0"
                       max="25"
                       value="0"
                       oninput="updateSliderValue(this, 'confidence-value')">
                <span id="confidence-value" class="text-sm text-gray-500">0%</span>
            </div>
        </div>
    </div>

    <!-- Add total marks display -->
    <div class="text-right mb-4">
        <span id="total-marks" class="text-lg font-semibold text-green-800">Total Marks: 0/100</span>
    </div>

    <!-- Rest of the evaluation form remains the same -->
    <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">Comments</label>
        <textarea id="evaluation-comments"
                  class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                  rows="4"
                  placeholder="Enter your comments here..."
                  oninput="checkFormValidity()"></textarea>
    </div>

    <div class="flex flex-wrap gap-6 mb-6">
        <label class="checkbox-wrapper">
            <input type="checkbox" id="tln-checkbox" onchange="checkFormValidity()">
            <span class="text-sm font-medium text-gray-700">TLN</span>
        </label>

        <label class="checkbox-wrapper">
            <input type="checkbox" id="local-checkbox" onchange="checkFormValidity()">
            <span class="text-sm font-medium text-gray-700">KPSM</span>
        </label>

        <label class="checkbox-wrapper">
            <input type="checkbox" id="fail-checkbox" onchange="checkFormValidity()">
            <span class="text-sm font-medium text-gray-700">Gagal</span>
        </label>
    </div>

    <button id="save-evaluation"
            onclick="saveEvaluation()"
            class="save-button bg-green-600 text-white px-6 py-2 rounded-lg w-full md:w-auto"
            disabled>
        Save Evaluation
    </button>
</div>
`;

            profilesContainer.innerHTML = `
    <div class="profile-card p-8">
        <div class="profile-header text-center mb-4">
            <h3 class="text-lg-center font-bold">${profile.KOR} - ${profile.NO_KUMP} - Nombor Indeks: ${profile.NO_INDEKS}</h3>
        </div>
        <div class="profile-header">
            <img src="${profile.ImageURL}" alt="${profile.NAMA_PENUH}" class="w-64 h-64 object-cover">
            <h2>${profile.NAMA_PENUH}</h2>
        </div>
        ${sectionsHTML}
        ${qualificationsHTML}
        ${evaluationHTML}
    </div>
`;

            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === profilesToUse.length - 1;
        }

        // Add to the existing menu item click event listener
document.querySelectorAll('.menu-item').forEach(item => {
    item.addEventListener('click', () => {
        // Remove active class from all menu items
        document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
        // Add active class to clicked item
        item.classList.add('active');
        
        const page = item.getAttribute('data-page');
        switch(page) {
            case 'home':
                currentGroup = '';
                filteredProfiles = [];
                currentIndex = 0;
                // Hide search container, show home content
                document.getElementById('searchContainer').classList.add('hidden');
                document.getElementById('homeContent').classList.remove('hidden');
                document.getElementById('profilesContainer').classList.add('hidden');
                document.querySelector('.flex.justify-center.gap-4.mt-8').classList.add('hidden');
                break;
            case 'result': // Now 'Search'
                // Show search container, hide other content
                document.getElementById('searchContainer').classList.remove('hidden');
                document.getElementById('homeContent').classList.add('hidden');
                document.getElementById('profilesContainer').classList.add('hidden');
                document.querySelector('.flex.justify-center.gap-4.mt-8').classList.add('hidden');
                break;
        }
    });
});

        // Add menu functionality
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', () => {
                // Remove active class from all menu items
                document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                // Add active class to clicked item
                item.classList.add('active');
                
                const page = item.getAttribute('data-page');
                switch(page) {
                    case 'home':
                        currentGroup = '';
                        filteredProfiles = [];
                        currentIndex = 0;
                        displayProfile(currentIndex);
                        break;
                    case 'result':
                        // Implement result page functionality here
                        break;
                }
            });
        });

    // Function to calculate and update total marks
    function updateTotalMarks() {
    const sliders = ['speech-slider', 'appearance-slider', 'idea-slider', 'confidence-slider'];
    const total = sliders.reduce((sum, id) => {
        return sum + Number(document.getElementById(id).value);
    }, 0);
    
    // Update total marks display
    const totalMarksElement = document.getElementById('total-marks');
    if (totalMarksElement) {
        totalMarksElement.textContent = `Total Marks: ${total}/100`;
    }
    return total;
    }
        
        function updateSliderValue(slider, valueId) {
            const value = slider.value;
            document.getElementById(valueId).textContent = value + '%';
            updateTotalMarks();
            checkFormValidity();
        }

        function checkFormValidity() {
            const sliders = ['speech-slider', 'appearance-slider', 'idea-slider', 'confidence-slider'];
            const comments = document.getElementById('evaluation-comments').value.trim();
            const saveButton = document.getElementById('save-evaluation');

            const slidersChanged = sliders.some(id => document.getElementById(id).value > 0);

            if ((slidersChanged || comments.length > 0) && selectedExaminer) {
                saveButton.disabled = false;
                saveButton.classList.add('active');
            } else {
                saveButton.disabled = true;
                saveButton.classList.remove('active');
            }
        }

        async function saveEvaluation() {
    if (!selectedExaminer) {
        alert('Please select an examiner profile before saving evaluation.');
        return;
    }

    // Show loading overlay
    document.getElementById('loadingOverlay').style.display = 'flex';

    // Calculate total score
    const scores = {
        speech: Number(document.getElementById('speech-slider').value),
        appearance: Number(document.getElementById('appearance-slider').value),
        idea: Number(document.getElementById('idea-slider').value),
        confidence: Number(document.getElementById('confidence-slider').value)
    };
    
    const totalScore = Object.values(scores).reduce((sum, score) => sum + score, 0);

    const currentProfile = currentGroup ? filteredProfiles[currentIndex] : profiles[currentIndex];
    const evaluationData = {
        examiner: selectedExaminer,
        name: currentProfile.NAMA_PENUH,
        kor: currentProfile.KOR,
        noKump: currentProfile.NO_KUMP,
        noIndeks: currentProfile.NO_INDEKS,
        speech: scores.speech,
        appearance: scores.appearance,
        idea: scores.idea,
        confidence: scores.confidence,
        totalScore: totalScore,
        comments: document.getElementById('evaluation-comments').value,
        tln: document.getElementById('tln-checkbox').checked,
        local: document.getElementById('local-checkbox').checked,
        fail: document.getElementById('fail-checkbox').checked,
        timestamp: new Date().toISOString()
    };

    try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbzBeroljLUU4v4vRVyps4McThQ7KUg9EQOVn8stdLvRfyiJw9K5L4eccvWlKXF2IDKG/exec', {
            method: 'POST',
            body: JSON.stringify(evaluationData)
        });

        if (response.ok) {
            // Hide loading overlay
            document.getElementById('loadingOverlay').style.display = 'none';
            
            // Show success message
            const successMessage = document.createElement('div');
            successMessage.style.position = 'fixed';
            successMessage.style.top = '50%';
            successMessage.style.left = '50%';
            successMessage.style.transform = 'translate(-50%, -50%)';
            successMessage.style.background = '#454B1B';
            successMessage.style.color = 'white';
            successMessage.style.padding = '1.5rem 2rem';
            successMessage.style.borderRadius = '0.5rem';
            successMessage.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
            successMessage.style.zIndex = '1000';
            successMessage.style.textAlign = 'center';
            successMessage.style.fontSize = '1.1rem';
            successMessage.style.fontWeight = '500';
            successMessage.textContent = `Evaluation saved successfully! Total Score: ${totalScore}/100`;
            
            document.body.appendChild(successMessage);
            
            // Remove success message after 3 seconds
            setTimeout(() => {
                successMessage.style.transition = 'opacity 0.5s ease-out';
                successMessage.style.opacity = '0';
                setTimeout(() => {
                    successMessage.remove();
                }, 500);
            }, 4000);

            if (currentIndex < (currentGroup ? filteredProfiles.length : profiles.length) - 1) {
                currentIndex++;
                displayProfile(currentIndex);
                // Add smooth scroll to top
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            }
            resetEvaluationForm();
        } else {
            throw new Error('Failed to save evaluation');
        }
    } catch (error) {
        // Hide loading overlay
        document.getElementById('loadingOverlay').style.display = 'none';
        alert('Error saving evaluation: ' + error.message);
    }
}
        
        // Update the total marks display style
        const totalMarksStyle = `
        .total-marks {
            background: #454B1B;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        `;
    // Add this function to your existing script
    function searchProfile() {
        const searchInput = document.getElementById('searchInput');
        const searchTerm = searchInput.value.trim();
    
        // Find profile by NO_TENTERA
        const foundProfile = profiles.find(profile => 
            profile.NO_TENTERA.toLowerCase() === searchTerm.toLowerCase()
        );
    
        if (foundProfile) {
            // Keep search container visible
            document.getElementById('searchContainer').classList.remove('hidden');
            
            // Show profile container
            document.getElementById('profilesContainer').classList.remove('hidden');
            
            // Hide navigation buttons
            document.querySelector('.flex.justify-center.gap-4.mt-8').classList.add('hidden');
            
            // Find the index of the found profile
            currentIndex = profiles.findIndex(profile => 
                profile.NO_TENTERA.toLowerCase() === searchTerm.toLowerCase()
            );
            
            // Display the profile without evaluation section
            displayProfileWithoutEvaluation(currentIndex);
        } else {
            alert('No profile found with this NO_TENTERA');
        }
    }

function displayProfileWithoutEvaluation(index) {
    const profile = profiles[index];
    
    const sections = [
        {
            title: 'Jawatan & Pasukan',
            fields: ['JAWATAN', 'PASUKAN', 'TAHUN_DI_PSK']
        },
        {
            title: 'Maklumat Perkhidmatan',
            fields: ['MULA_KHIDMAT', 'TARIKH_TAULIAH', 'TAHUN_KHIDMAT', 'PENGAMBILAN', 'CATATAN']
        },
        {
            title: 'Maklumat Peribadi',
            fields: ['TARIKH_LAHIR', 'UMUR', 'TEMPAT_LAHIR', 'STATUS', 'AKADEMIK', 'BMI','UKA']
        }
    ];

    const qualificationsSection = {
        title: 'Kursus & Pencapaian',
        groups: [
            {
                title: '',
                fields: ['MERIT']
            },
            {
                title: 'G2',
                value: 'Siri ' + formatQualification(profile, 'SIRI_G2', 'KED_G2', 'GRED_G2')
            },
            {
                title: 'G3',
                value: 'Siri ' + formatQualification(profile, 'SIRI_G3', 'KED_G3', 'GRED_G3')
            },
            {
                title: 'Ketua Kompeni',
                value: 'Siri ' + formatQualification(profile, 'SIRI_KK', 'KED_KK', 'GRED_KK')
            },
            {
                title: 'Kursus Lain',
                fields: ['KURSUS_BAHASA', 'KURSUS_UN', 'PENGLIBATAN_LUAR_NEGARA']
            },
            {
                title: 'Ujian ADFELPS',
                fields: ['SPEAKING', 'LISTENING', 'READING', 'WRITING']
            }
        ]
    };

    // Use the existing HTML generation logic from displayProfile, but remove the evaluationHTML
    const sectionsHTML = sections.map(section => `
        <div class="mb-8">
            <h3 class="section-header text-lg font-semibold">${section.title}</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${section.fields.map(field => `
                    <div class="flex flex-col">
                        <span class="text-sm text-gray-500">${field.replace(/_/g, ' ')}</span>
                        <span class="font-medium">${profile[field] || '-'}</span>
                    </div>
                `).join('')}
            </div>
        </div>
    `).join('');

    const qualificationsHTML = `
        <div class="mb-8">
            <h3 class="section-header text-lg font-semibold">${qualificationsSection.title}</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                ${qualificationsSection.groups.map(group => {
                    if (group.fields) {
                        return `
                            <div class="qualification-item">
                                <h4 class="font-medium text-green-800 mb-2">${group.title}</h4>
                                ${group.fields.map(field => `
                                    <div class="mb-2">
                                        <span class="text-sm text-gray-500">${field.replace(/_/g, ' ')}</span>
                                        <span class="block font-medium">${profile[field] || '-'}</span>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        return `
                            <div class="qualification-item">
                                <h4 class="font-medium text-green-800 mb-2">${group.title}</h4>
                                <span class="block font-medium">${group.value}</span>
                            </div>
                        `;
                    }
                }).join('')}
            </div>
        </div>
    `;

    profilesContainer.innerHTML = `
        <div class="profile-card p-8">
            <div class="profile-header text-center mb-4">
                <h3 class="text-lg-center font-bold">${profile.KOR} - ${profile.NO_KUMP} - Nombor Indeks: ${profile.NO_INDEKS}</h3>
            </div>
            <div class="profile-header">
                <img src="${profile.ImageURL}" alt="${profile.NAMA_PENUH}" class="w-64 h-64 object-cover">
                <h2>${profile.NAMA_PENUH}</h2>
            </div>
            ${sectionsHTML}
            ${qualificationsHTML}
        </div>
    `;

    // Disable navigation buttons
    prevBtn.disabled = true;
    nextBtn.disabled = true;
}

document.querySelectorAll('.menu-item').forEach(item => {
    item.addEventListener('click', () => {
        // Remove active class from all menu items
        document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
        // Add active class to clicked item
        item.classList.add('active');
        
        const page = item.getAttribute('data-page');
        
        // Collapse all KOR groups when clicking Home or Search
        if (page === 'home' || page === 'result') {
            document.querySelectorAll('[data-kor]').forEach(el => {
                el.classList.add('hidden');
            });
        }
        
        switch(page) {
            case 'home':
                currentGroup = '';
                filteredProfiles = [];
                currentIndex = 0;
                // Hide search container and show home content
                document.getElementById('searchContainer').classList.add('hidden');
                document.getElementById('homeContent').classList.remove('hidden');
                document.getElementById('profilesContainer').classList.add('hidden');
                document.querySelector('.flex.justify-center.gap-4.mt-8').classList.add('hidden');
                break;
                
            case 'result':
                // Show search container, hide other content
                document.getElementById('searchContainer').classList.remove('hidden');
                document.getElementById('homeContent').classList.add('hidden');
                document.getElementById('profilesContainer').classList.add('hidden');
                document.querySelector('.flex.justify-center.gap-4.mt-8').classList.add('hidden');
                break;
        }
    });
});

// Add event listeners for search
document.addEventListener('DOMContentLoaded', () => {
    const searchButton = document.getElementById('searchButton');
    const searchInput = document.getElementById('searchInput');

    // Search on button click
    searchButton.addEventListener('click', searchProfile);

    // Search on Enter key press
    searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            searchProfile();
        }
    });
});

function resetEvaluationForm() {
    const sliders = ['speech-slider', 'appearance-slider', 'idea-slider', 'confidence-slider'];
    sliders.forEach(id => {
        const slider = document.getElementById(id);
        slider.value = 0; // Reset to 0 instead of 75
        document.getElementById(id.replace('-slider', '-value')).textContent = '0%';
    });
    
    document.getElementById('evaluation-comments').value = '';
    document.getElementById('tln-checkbox').checked = false;
    document.getElementById('local-checkbox').checked = false;
    document.getElementById('fail-checkbox').checked = false;
    
    // Reset total marks
    updateTotalMarks();
    checkFormValidity();
}

        prevBtn.addEventListener('click', () => {
            if (currentIndex > 0) {
                currentIndex--;
                displayProfile(currentIndex);
            }
        });

        nextBtn.addEventListener('click', () => {
            const maxIndex = currentGroup ? 
                filteredProfiles.length - 1 : 
                profiles.length - 1;
            
            if (currentIndex < maxIndex) {
                currentIndex++;
                displayProfile(currentIndex);
            }
        });

        fetchData().then(() => {
            initializeExaminerSelection();
            // Set home as active by default and show home page
            document.querySelector('[data-page="home"]').classList.add('active');
            showHomePage();
        });
    </script>

<footer class="footer">
    <div class="footer-content">
        <p class="copyright">Â© 2025 All Rights Reserved.</p>
        <p class="text-sm mt-2 opacity-75">Developed by ICT-Inf Dir</p>
    </div>
</footer>
</body>
</html>
